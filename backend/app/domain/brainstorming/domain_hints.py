"""
Add-on 도메인 힌트 모듈

직군별 방향성을 가볍게 제시하는 선택적 힌트 시스템입니다.
- 편향을 강하게 만들지 않고, 방향성만 살짝 제공
- 사용자 정보는 저장하지 않음 (일회성 프롬프트 조합용)
- Ephemeral RAG 철학 유지: 다른 아이디어에 영향 없음
"""

# 직군별 힌트 정의
DOMAIN_HINTS = {
    "수험생": """
이해 중심·패턴 중심으로 사고할 수 있도록 부드럽게 유도합니다.
루틴을 강요하지 않고, 본인이 선호하는 방식에 맞춰 변형 가능한 아이디어를 제시합니다.
과목별 특성에 맞는 작은 단서 정도를 제공하여 사용자의 자율성을 지원합니다.""",

    "직장인": """
업무 효율·피로도·정리 방식 등 '일상의 불편'을 줄이는 방향성을 강조합니다.
비용이나 특정 프로그램 의존 없이 기존 환경 안에서 해결 가능한 제안을 제공합니다.
빠른 성과보다 현실적인 완화·정리 중심의 아이디어를 우선합니다.""",

    "크리에이터": """
콘텐츠의 기획·테마·연출 등 핵심 결정 요소가 잘 떠오르도록 가볍게 자극합니다.
전문 장비·편집 툴에 집중하지 않고, 대중적·직관적인 콘텐츠 구상 방향을 제시합니다.
타깃층·썸네일·주제 선택 등 결과에 영향이 큰 부분에 선택지를 제공합니다.""",

    "소상공인": """
단기 개선(노출·경험)과 장기 방향(운영·브랜딩)을 균형 있게 제안합니다.
업종에 상관없이 적용 가능한 보편적 시각을 유지합니다.
과도한 전문 분석 없이, 사장님이 스스로 판단할 수 있는 선택지를 제시합니다.""",

    "기획자": """
문제 정의 → 가치 제안 → 실행 옵션의 구조적 흐름이 자연스럽게 잡히도록 돕습니다.
과도한 전문 프레임워크 없이 누구나 이해하는 기획 언어로 아이디어를 제시합니다.
실험 가능한 작은 조각과 중장기 전략 관점을 함께 보여줘 선택 폭을 넓힙니다.""",

    "개발자": """
기술보다 문제 해결 흐름·사용자 행동·데이터 흐름 같은 본질에 집중하는 방향성을 줍니다.
특정 기술 스택을 고정하지 않고 다수의 선택지를 열어둔 중립적 제안을 제공합니다.
복잡성을 불필요하게 높이지 않는 단순·명확한 해결법을 우선 제시합니다.""",

    "작가": """
소재 발상·표현·구성의 힌트를 제공하여 글의 출발점을 쉽게 만들어줍니다.
특정 장르에 한정되지 않도록 다양한 스타일의 시도를 제안합니다.
무거운 글쓰기보단 가볍게 시작 가능한 작은 발화 포인트를 제공합니다."""
}

# 직군 감지용 키워드 매핑
DOMAIN_KEYWORDS = {
    "수험생": ["수험생", "학생", "시험", "공부", "수능", "입시", "대학", "학교", "고등학생", "중학생"],
    "직장인": ["직장인", "회사원", "업무", "사무실", "회사", "상사", "팀", "야근", "직장", "근무"],
    "크리에이터": ["유튜버", "크리에이터", "영상", "콘텐츠", "유튜브", "썸네일", "편집", "촬영", "브이로그", "쇼츠"],
    "소상공인": ["소상공인", "자영업", "가게", "매장", "카페", "음식점", "학원", "수강생", "사장", "장사"],
    "기획자": ["기획자", "PM", "마케터", "마케팅", "캠페인", "전략", "기획", "프로덕트", "서비스"],
    "개발자": ["개발자", "개발", "프로그래밍", "코딩", "앱", "웹", "프로그램", "소프트웨어", "API", "시스템"],
    "작가": ["작가", "블로거", "글", "블로그", "소설", "에세이", "칼럼", "기고", "집필", "원고"]
}


def detect_domain(purpose: str) -> str:
    """
    Q1 목적 텍스트를 분석하여 직군을 감지합니다.
    
    Args:
        purpose: Q1에서 입력한 목적 텍스트
        
    Returns:
        str: 감지된 직군명 (없으면 빈 문자열)
    """
    purpose_lower = purpose.lower()
    
    # 각 직군의 키워드를 확인
    for domain, keywords in DOMAIN_KEYWORDS.items():
        for keyword in keywords:
            if keyword in purpose_lower or keyword in purpose:
                return domain
    
    # 감지 실패
    return ""


def get_domain_hint(purpose: str) -> str:
    """
    Q1 목적을 보고 적절한 직군별 힌트를 반환합니다.
    
    **중요**: 이 힌트는 저장되지 않으며, 프롬프트 조합용으로만 일회성 사용됩니다.
    Ephemeral RAG 철학을 유지하여 다른 아이디어에 영향을 주지 않습니다.
    
    Args:
        purpose: Q1에서 입력한 목적 텍스트
        
    Returns:
        str: 직군별 힌트 텍스트 (없으면 빈 문자열)
    """
    domain = detect_domain(purpose)
    
    if domain and domain in DOMAIN_HINTS:
        hint = DOMAIN_HINTS[domain]
        print(f"   💡 감지된 직군: {domain}")
        print(f"   📌 방향성 힌트가 적용됩니다 (편향 최소화, 가이드만 제공)\n")
        return hint
    
    # 직군 감지 실패 시 빈 문자열
    return ""


def format_hint_for_prompt(hint: str) -> str:
    """
    힌트를 프롬프트에 삽입할 형식으로 포맷팅합니다.
    
    Args:
        hint: 원본 힌트 텍스트
        
    Returns:
        str: 포맷팅된 힌트 (빈 문자열이면 그대로 반환)
    """
    if not hint:
        return ""
    
    return f"""
---

【직군별 방향성 힌트】
{hint}

*이 힌트는 방향성만 제시하며, 편향을 강하게 만들지 않습니다.
*힌트는 저장되지 않으며, 이번 세션에만 일회성으로 적용됩니다.

---
"""


# 테스트 코드
if __name__ == "__main__":
    print("=" * 60)
    print("도메인 힌트 모듈 테스트")
    print("=" * 60)
    
    test_cases = [
        "수험생을 위한 공부 방법",
        "직장인 업무 효율화",
        "유튜브 영상 기획",
        "소상공인 학원 수강생 모집",
        "개발자 앱 개발",
        "블로그 글쓰기",
        "일반적인 아이디어"  # 감지 실패 케이스
    ]
    
    for purpose in test_cases:
        print(f"\n📋 Q1 목적: {purpose}")
        domain = detect_domain(purpose)
        if domain:
            print(f"   ✅ 감지: {domain}")
            hint = get_domain_hint(purpose)
            print(f"   힌트 길이: {len(hint)}자")
        else:
            print(f"   ⚠️  감지 실패 (일반 모드)")
    
    print("\n" + "=" * 60)
    print("✅ 테스트 완료")
    print("=" * 60)

